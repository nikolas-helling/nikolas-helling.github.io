<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Rotational Motion Control for Quadcopter | Nikolas Helling </title> <meta name="author" content="Nikolas Helling"> <meta name="description" content="Roll-pitch-yaw model-based control for a custom quadcopter, using PID, LQR, and MPC controllers"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/pers_website_logo.jpg?a5fd628cc23908530730ebfa2d4089ed"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nikolas-helling.github.io/projects/3_project/"> <script src="/assets/js/theme.js?bc98222b904c9daed12bdba53b2b5c28"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Nikolas</span> <span class="font-weight-bold">Helling</span> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About Me </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Rotational Motion Control for Quadcopter</h1> <p class="post-description">Roll-pitch-yaw model-based control for a custom quadcopter, using PID, LQR, and MPC controllers</p> </header> <article> <p>For a semester project at the Automation and Control Laboratory at Politecnico di Milano, I was assigned with a team to a project aimed at developing rotational motion control for a custom quadcopter. The project involved implementing model-based controllers and comparing their performance in terms of the autonomous orientation of the drone, using MATLAB and Simulink for control and simulation, and custom Arduino plugins for deploying code to the on-board ArduCopter. The goal was to build a robust control system from the ground up, starting from non-linear modeling and system identification, to control and performance testing on the real quadcopter.</p> <p>After estimating an accurate model of the quadcopter’s dynamics, a set of model-based controllers were designed and tested in simulation. The developed controllers were then deployed on the real system and fine-tuned through hands-on experiments, achieving robust control performance and satisfactory sim-to-real transfer. While the project is not fully reproducible due to our custom drone configuration, most of the base simulation code is available on <a href="https://github.com/nikolas-helling/drone_attitude_control.git" rel="external nofollow noopener" target="_blank">GitHub</a>. The repository includes base templates for different quadcopter models, system identification scripts and model-based controllers, including PID, LQR and MPC. All functions can be easily adapted to similar quadcopter architectures and used as foundation for developing a model-based attitude control system for a custom setup.</p> <div class="row align-items-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/drone-480.webp 480w,/assets/img/proj3/drone-800.webp 800w,/assets/img/proj3/drone-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/drone.jpg" class="img-fluid rounded z-depth-1" width="70%" height="70%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Custom constrained quadcopter setup. </div> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/drone_springs-480.webp 480w,/assets/img/proj3/drone_springs-800.webp 800w,/assets/img/proj3/drone_springs-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/drone_springs.jpg" class="img-fluid rounded z-depth-1" width="70%" height="70%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Spring setup of experiments. </div> </div> </div> <p>Our setup was composed of a custom lightweight quadcopter with a cross-like symmetrical structure, attached to a 3 d.o.f. rotational hinge constraining all its linear motions and isolating roll-pitch-yaw maneuvers. The control system was deployed to the on-board pc, equipped with a basic 50Hz IMU and 4 ESC’s controlling 4 PMDC motors through suitable PWM signals. Sensor readings processed by the controllers were transformed into PWM control inputs (duty cycles of PWM signals) fed to the ESC’s to obtain the desired reference trajectory following. Having no direct measurement of motor speeds added additional complexity in the control system design.</p> <p>Given the simple sensor setup and the few available technical characteristics of the drone, an important part of the project was estimating missing parameters such as the inertia tensor, aerodynamic properties and geometrical values. Additionally, the control transformation between torques and thrusts applied on the system and the relationship with motor dynamics were also unknown. This part was tackled using both custom system identification approaches and standard black-box and grey-box estimation algorithms.</p> <div class="row align-items-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/drone_osc-480.webp 480w,/assets/img/proj3/drone_osc-800.webp 800w,/assets/img/proj3/drone_osc-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/drone_osc.png" class="img-fluid rounded z-depth-1" width="70%" height="70%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Damped oscillations for inertia tensor identification. </div> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/n4sid-480.webp 480w,/assets/img/proj3/n4sid-800.webp 800w,/assets/img/proj3/n4sid-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/n4sid.png" class="img-fluid rounded z-depth-1" width="100%" height="100%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Example output of black-box linear model identification (n4sid). </div> </div> </div> <p>In particular, we relied on a physical spring setup combined with a set of damped oscillations experiments to estimate roughly the roll and pitch inertia in the body frame. Similarly, the setup was used to estimate the relationship between the control signal (the manipulated variable) and the corresponding aerodynamic thrust for each motor. Using geometrical considerations and assuming the drone in a hover condition, we also estimated the relationship between thrusts, motor torques and torques generated around the body frame. While this procedure was empirical, it produced reasonable estimates to be used in the model-based estimation part.</p> <p>We developed nonlinear dynamic models using various assumptions, from considering gyroscopic effects to center of mass displacement from the hinge and motor dynamics. The models were used in MATLAB with nonlinear grey-box algorithms (e.g. nlgreyest) to estimate missing parameters, such as yaw and rotor inertia, thrust and torque coefficients, and geometric lengths. The estimated parameters were sufficient for developing model-based controllers, but the estimation proved to be very complex given the many non-idealities such as disturbances from reaction forces at the hinge, an unstable system which required closed loop excitation experiments, and a few reliable initial parameter guesses.</p> <p>A set of black-box estimation approaches (e.g. n4sid, ssest) also proved to be suitable for estimating the matrices of the linearized system around the equilibrium. Controllers based of the identified state space model were satisfactory enough for simple trajectories not far from the stability condition, while more complex controllers (e.g. MPC, LQR) and models were better suited for generic coupled roll-pitch-yaw maneuvers.</p> <div class="column"> <div class="row-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/step-480.webp 480w,/assets/img/proj3/step-800.webp 800w,/assets/img/proj3/step-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/step.png" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="row-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/sine-480.webp 480w,/assets/img/proj3/sine-800.webp 800w,/assets/img/proj3/sine-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/sine.png" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Sine and step reference trajectory following. </div> <p>The control system was designed and tuned in Simulink using custom MATLAB controller implementations (see <a href="https://github.com/nikolas-helling/drone_attitude_control.git" rel="external nofollow noopener" target="_blank">here</a>). The set of model-based controllers were tested on the real quadcopter considering both the free system (3 d.o.f.) and each orientation component independently.</p> <p>The implemented controllers include: decentralized PID’s, static pole placement (PP), static LQR, gain-scheduled LQR, gain-scheduled MPC. By static we mean that the controllers are designed using the estimated linearized model of the system, while gain-scheduled means the controllers are adapted in real-time depending on the operating point, thus being more accurate but without the need of a full nonlinear control architecture. This simplification allows for better performance with respect to linear-based controllers but also significantly lowers real-time computational cost, which is critical considering the simple on-board processor.</p> <p>A series of control results from real experiments are shown in the following media. The developed control pipeline allows for effective stabilization and satisfactory trajectory tracking for various aggressive signals, such as step references. Moreover, the controllers are robust to external disturbances, as is shown in some of the videos below. Paired with a more reliable estimation setup and enlarged with linear motion control, this work provides a strong base for future flight control architecture that can achieve aggressive mid-flight maneuvers, especially for rotational motions. This project was a great opportunity for collaborating to achieve a complete autonomous system from start to finish, applying interdisciplinary control knowledge on a real-world system.</p> <div class="row align-items-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <video src="/assets/video/ctrl_dist1.mp4" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" autoplay="" controls="" loop=""></video> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <video src="/assets/video/ctrl_dist2.mp4" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" autoplay="" controls="" loop=""></video> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <video src="/assets/video/ctrl_dist3.mp4" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" autoplay="" controls="" loop=""></video> </figure> </div> </div> <div class="caption"> Some examples of the quadcopter's orientation control, considering also significant external disturbances. </div> <div class="row align-items-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/comparison-480.webp 480w,/assets/img/proj3/comparison-800.webp 800w,/assets/img/proj3/comparison-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/comparison.png" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="Application setup" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Comparison of different model-based controllers tuned in simulation for trajectory tracking. </div> </div> </div> <div class="row align-items-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/proj3/dist-480.webp 480w,/assets/img/proj3/dist-800.webp 800w,/assets/img/proj3/dist-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/proj3/dist.png" class="img-fluid rounded z-depth-1" width="80%" height="80%" style="display: flex; justify-content: center; align-items: center; margin: auto;" title="Application setup" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Example roll-pitch-yaw experiment results considering also manual disturbances after the trajectory. </div> </div> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Nikolas Helling. Powered by Jekyll with al-folio theme and hosted on GitHub Pages. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script>for(var wechatModal=document.getElementById("WeChatMod"),wechatBtn=document.querySelectorAll('[id="WeChatBtn"]'),i=0;i<wechatBtn.length;i++)wechatBtn[i].onclick=function(){wechatModal.style.display="block"};window.onclick=function(t){t.target==wechatModal&&(wechatModal.style.display="none")};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>